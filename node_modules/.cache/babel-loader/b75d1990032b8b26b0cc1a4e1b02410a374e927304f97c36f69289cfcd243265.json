{"ast":null,"code":"var _jsxFileName = \"C:\\\\xampp\\\\htdocs\\\\pre_order\\\\pre_order_system_frontend\\\\src\\\\context\\\\AuthContext.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { createContext, useContext, useState, useEffect } from \"react\";\nimport api from \"../api/api\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AuthContext = /*#__PURE__*/createContext();\nexport function AuthProvider({\n  children\n}) {\n  _s();\n  const [user, setUser] = useState(() => {\n    const stored = localStorage.getItem(\"user\");\n    return stored ? JSON.parse(stored) : null;\n  });\n  const [loading, setLoading] = useState(true);\n\n  // -------------------------------------------------------\n  //  SAFE USER SETTER (SYNC LOCALSTORAGE + STATE)\n  // -------------------------------------------------------\n  const updateUser = updatedUser => {\n    if (!updatedUser) return;\n    localStorage.setItem(\"user\", JSON.stringify(updatedUser));\n    setUser(updatedUser); // ðŸ”¥ triggers UI re-render instantly\n  };\n\n  // -------------------------------------------------------\n  //  LOAD USER + TOKEN ON APP START\n  // -------------------------------------------------------\n  useEffect(() => {\n    const bootstrapAuth = async () => {\n      try {\n        const storedUser = localStorage.getItem(\"user\");\n        const token = localStorage.getItem(\"token\");\n        if (storedUser && token) {\n          api.defaults.headers.common[\"Authorization\"] = `Bearer ${token}`;\n\n          // Validate token against backend to avoid stale sessions\n          try {\n            const res = await api.get(\"/user\");\n            const freshUser = res.data.user || res.data;\n            if (freshUser) {\n              updateUser(freshUser);\n            } else {\n              throw new Error(\"Invalid user payload\");\n            }\n          } catch (err) {\n            var _err$response;\n            // If backend is down (500) keep the cached user so the UI can still render\n            const parsedUser = JSON.parse(storedUser);\n            const status = err === null || err === void 0 ? void 0 : (_err$response = err.response) === null || _err$response === void 0 ? void 0 : _err$response.status;\n            console.warn(\"Token validation failed:\", status, err === null || err === void 0 ? void 0 : err.message);\n            if (status === 401) {\n              // Invalid token â€” clear session\n              localStorage.removeItem(\"user\");\n              localStorage.removeItem(\"token\");\n              delete api.defaults.headers.common[\"Authorization\"];\n              setUser(null);\n            } else {\n              // Keep cached user for non-auth errors (e.g., 500)\n              setUser(parsedUser);\n            }\n          }\n        }\n      } catch (err) {\n        console.warn(\"ðŸš¨ Corrupted localStorage user:\", err);\n        localStorage.removeItem(\"user\");\n        localStorage.removeItem(\"token\");\n      } finally {\n        setLoading(false);\n      }\n    };\n    bootstrapAuth();\n  }, []);\n\n  // -------------------------------------------------------\n  //  LOGIN (NOW FETCHES FRESH USER DATA)\n  // -------------------------------------------------------\n  async function login(email, password) {\n    const response = await api.post(\"/login\", {\n      email,\n      password\n    });\n    const {\n      user,\n      token\n    } = response.data;\n    localStorage.setItem(\"token\", token);\n    localStorage.setItem(\"user\", JSON.stringify(user));\n    api.defaults.headers.common[\"Authorization\"] = `Bearer ${token}`;\n    setUser(user);\n    return user;\n  }\n\n  // -------------------------------------------------------\n  //  LOGOUT\n  // -------------------------------------------------------\n  async function logout() {\n    try {\n      await api.post(\"/logout\");\n    } catch (err) {\n      // Even if API fails, clear local state\n      console.warn(\"Logout API failed:\", err.message);\n    } finally {\n      // Always clear local storage and state\n      localStorage.removeItem(\"user\");\n      localStorage.removeItem(\"token\");\n      delete api.defaults.headers.common[\"Authorization\"];\n      setUser(null);\n\n      // Redirect to login page\n      window.location.href = \"/login\";\n    }\n  }\n\n  // -------------------------------------------------------\n  //  REFRESH USER DATA FROM BACKEND\n  //  (Used after updating profile)\n  // -------------------------------------------------------\n  async function refreshUser() {\n    try {\n      const token = localStorage.getItem(\"token\");\n      if (!token) return;\n      const response = await api.get(\"/user\", {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      });\n      updateUser(response.data.user || response.data);\n    } catch (err) {\n      console.warn(\"Failed to refresh user:\", err);\n    }\n  }\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: {\n      user,\n      setUser: updateUser,\n      // ðŸ”¥ used by Profile.js\n      login,\n      logout,\n      refreshUser,\n      // ðŸ”¥ call this after saving profile\n      loading\n    },\n    children: !loading && children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 131,\n    columnNumber: 5\n  }, this);\n}\n_s(AuthProvider, \"7hhz6zhp5XPXkwmb/VMKXDEe10Q=\");\n_c = AuthProvider;\nexport function useAuth() {\n  _s2();\n  return useContext(AuthContext);\n}\n_s2(useAuth, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","api","jsxDEV","_jsxDEV","AuthContext","AuthProvider","children","_s","user","setUser","stored","localStorage","getItem","JSON","parse","loading","setLoading","updateUser","updatedUser","setItem","stringify","bootstrapAuth","storedUser","token","defaults","headers","common","res","get","freshUser","data","Error","err","_err$response","parsedUser","status","response","console","warn","message","removeItem","login","email","password","post","logout","window","location","href","refreshUser","Authorization","Provider","value","fileName","_jsxFileName","lineNumber","columnNumber","_c","useAuth","_s2","$RefreshReg$"],"sources":["C:/xampp/htdocs/pre_order/pre_order_system_frontend/src/context/AuthContext.js"],"sourcesContent":["import React, { createContext, useContext, useState, useEffect } from \"react\";\r\nimport api from \"../api/api\";\r\n\r\nconst AuthContext = createContext();\r\n\r\nexport function AuthProvider({ children }) {\r\n  const [user, setUser] = useState(() => {\r\n    const stored = localStorage.getItem(\"user\");\r\n    return stored ? JSON.parse(stored) : null;\r\n  });\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  // -------------------------------------------------------\r\n  //  SAFE USER SETTER (SYNC LOCALSTORAGE + STATE)\r\n  // -------------------------------------------------------\r\n  const updateUser = (updatedUser) => {\r\n    if (!updatedUser) return;\r\n    localStorage.setItem(\"user\", JSON.stringify(updatedUser));\r\n    setUser(updatedUser); // ðŸ”¥ triggers UI re-render instantly\r\n  };\r\n\r\n  // -------------------------------------------------------\r\n  //  LOAD USER + TOKEN ON APP START\r\n  // -------------------------------------------------------\r\n  useEffect(() => {\r\n    const bootstrapAuth = async () => {\r\n      try {\r\n        const storedUser = localStorage.getItem(\"user\");\r\n        const token = localStorage.getItem(\"token\");\r\n\r\n        if (storedUser && token) {\r\n          api.defaults.headers.common[\"Authorization\"] = `Bearer ${token}`;\r\n\r\n          // Validate token against backend to avoid stale sessions\r\n          try {\r\n            const res = await api.get(\"/user\");\r\n            const freshUser = res.data.user || res.data;\r\n            if (freshUser) {\r\n              updateUser(freshUser);\r\n            } else {\r\n              throw new Error(\"Invalid user payload\");\r\n            }\r\n          } catch (err) {\r\n            // If backend is down (500) keep the cached user so the UI can still render\r\n            const parsedUser = JSON.parse(storedUser);\r\n            const status = err?.response?.status;\r\n            console.warn(\"Token validation failed:\", status, err?.message);\r\n\r\n            if (status === 401) {\r\n              // Invalid token â€” clear session\r\n              localStorage.removeItem(\"user\");\r\n              localStorage.removeItem(\"token\");\r\n              delete api.defaults.headers.common[\"Authorization\"];\r\n              setUser(null);\r\n            } else {\r\n              // Keep cached user for non-auth errors (e.g., 500)\r\n              setUser(parsedUser);\r\n            }\r\n          }\r\n        }\r\n      } catch (err) {\r\n        console.warn(\"ðŸš¨ Corrupted localStorage user:\", err);\r\n        localStorage.removeItem(\"user\");\r\n        localStorage.removeItem(\"token\");\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    bootstrapAuth();\r\n  }, []);\r\n\r\n  // -------------------------------------------------------\r\n  //  LOGIN (NOW FETCHES FRESH USER DATA)\r\n  // -------------------------------------------------------\r\n  async function login(email, password) {\r\n    const response = await api.post(\"/login\", { email, password });\r\n\r\n    const { user, token } = response.data;\r\n\r\n    localStorage.setItem(\"token\", token);\r\n    localStorage.setItem(\"user\", JSON.stringify(user));\r\n\r\n    api.defaults.headers.common[\"Authorization\"] = `Bearer ${token}`;\r\n    setUser(user);\r\n\r\n    return user;\r\n  }\r\n\r\n  // -------------------------------------------------------\r\n  //  LOGOUT\r\n  // -------------------------------------------------------\r\n  async function logout() {\r\n    try {\r\n      await api.post(\"/logout\");\r\n    } catch (err) {\r\n      // Even if API fails, clear local state\r\n      console.warn(\"Logout API failed:\", err.message);\r\n    } finally {\r\n      // Always clear local storage and state\r\n      localStorage.removeItem(\"user\");\r\n      localStorage.removeItem(\"token\");\r\n      delete api.defaults.headers.common[\"Authorization\"];\r\n      setUser(null);\r\n\r\n      // Redirect to login page\r\n      window.location.href = \"/login\";\r\n    }\r\n  }\r\n\r\n  // -------------------------------------------------------\r\n  //  REFRESH USER DATA FROM BACKEND\r\n  //  (Used after updating profile)\r\n  // -------------------------------------------------------\r\n  async function refreshUser() {\r\n    try {\r\n      const token = localStorage.getItem(\"token\");\r\n      if (!token) return;\r\n\r\n      const response = await api.get(\"/user\", {\r\n        headers: { Authorization: `Bearer ${token}` },\r\n      });\r\n\r\n      updateUser(response.data.user || response.data);\r\n    } catch (err) {\r\n      console.warn(\"Failed to refresh user:\", err);\r\n    }\r\n  }\r\n\r\n  return (\r\n    <AuthContext.Provider\r\n      value={{\r\n        user,\r\n        setUser: updateUser, // ðŸ”¥ used by Profile.js\r\n        login,\r\n        logout,\r\n        refreshUser, // ðŸ”¥ call this after saving profile\r\n        loading,\r\n      }}\r\n    >\r\n      {!loading && children}\r\n    </AuthContext.Provider>\r\n  );\r\n}\r\n\r\nexport function useAuth() {\r\n  return useContext(AuthContext);\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}